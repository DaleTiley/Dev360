@model IEnumerable<MillinniumWebFixed.Models.ProductMapping>
@{
    ViewBag.Title = "Product Mappings";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    #mappingsTable td,
    #mappingsTable th {
        padding: 4px 8px !important;
        vertical-align: middle;
    }
</style>

<div class="container mt-3">
    <h4>Product Mappings</h4>
    <a href="@Url.Action("Index", "Admin")" class="btn mb-3 theme-button btn-sm">
        ← Back to Admin Panel
    </a>
    <a class="btn theme-button btn-sm mb-3" href="@Url.Action("AddProductMapping")">
        <i class="fas fa-plus"></i> Add New Mapping
    </a>

    @if (TempData["Message"] != null)
    {
        var encodedMessage = System.Web.HttpUtility.JavaScriptStringEncode(TempData["Message"].ToString());
        <script>
        window.addEventListener('DOMContentLoaded', function () {
            showToast("@encodedMessage", "success");
        });
        </script>
    }

    <div class="table-responsive small">
        <table id="mappingsTable" class="table table-bordered table-sm table-striped">
            <thead class="table-dark">
                <tr>
                    <th>JSON Item Name</th>
                    <th>Product Name (Stock)</th>
                    <th>Notes</th>
                    <th style="width: 100px; text-align:center;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var m in Model)
                {
                    <tr>
                        <td>@m.JsonItemName</td>
                        <td>@m.ProductDesc</td>
                        <td>@m.Notes</td>
                        <td style="text-align:center;">
                            <a class="btn btn-sm btn-outline-primary" href="@Url.Action("EditProductMapping", new { id = m.Id })">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="btn btn-sm btn-outline-danger" onclick="confirmDeleteMapping(@m.Id)">
                                <i class="fas fa-trash"></i>
                            </button>

                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Global Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content confirm-delete-modal shadow border rounded-3">
            <div class="modal-header bg-danger text-white py-2 px-3">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <span id="deleteModalMessage">Are you sure you want to delete this item?</span>
            </div>
            <div class="modal-footer justify-content-center">
                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
                <button id="confirmDeleteBtn" class="btn btn-danger">Yes, Delete</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#mappingsTable').DataTable({
                responsive: true,
                pageLength: 10,
                lengthMenu: [
                    [5, 10, 25, 50, 100, -1],
                    [5, 10, 25, 50, 100, "All"]
                ],
                order: [[0, 'asc']]
            });
        });

        let deleteId = 0;

        function confirmDeleteMapping(id) {
            deleteId = id;
            document.getElementById("deleteModalMessage").innerText = "Are you sure you want to delete this mapping?";
            const modal = new bootstrap.Modal(document.getElementById("confirmDeleteModal"));
            modal.show();
        }

        document.getElementById("confirmDeleteBtn").addEventListener("click", function () {
            if (deleteId > 0) {
                window.location.href = '/Admin/DeleteProductMapping/' + deleteId;
            }
        });
    </script>
}
